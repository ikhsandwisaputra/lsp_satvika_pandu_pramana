<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ============================================ -->
    <!-- USER SESSION VIEWS (Multi-Device Tracking) -->
    <!-- ============================================ -->

    <!-- Session List View -->
    <record id="view_cert_user_session_list" model="ir.ui.view">
        <field name="name">cert.user.session.list</field>
        <field name="model">cert.user.session</field>
        <field name="arch" type="xml">
            <list create="0" decoration-success="is_active" decoration-muted="not is_active">
                <field name="user_id"/>
                <field name="ip_address"/>
                <field name="login_time"/>
                <field name="last_activity"/>
                <field name="is_active" widget="boolean"/>
                <field name="logout_reason" optional="show"/>
                <field name="logout_time" optional="hide"/>
                <button name="action_force_logout" string="Force Logout" type="object"
                        class="btn-warning" icon="fa-power-off"
                        invisible="not is_active"
                        confirm="Yakin ingin mengakhiri session user ini?"/>
                <button name="action_clear_all_user_sessions" string="Clear All" type="object"
                        class="btn-danger" icon="fa-trash"
                        confirm="HAPUS SEMUA session user ini? User harus login ulang!"/>
            </list>
        </field>
    </record>

    <!-- Session Form View -->
    <record id="view_cert_user_session_form" model="ir.ui.view">
        <field name="name">cert.user.session.form</field>
        <field name="model">cert.user.session</field>
        <field name="arch" type="xml">
            <form create="0">
                <header>
                    <button name="action_force_logout" string="Force Logout" type="object"
                            class="btn-warning" icon="fa-power-off"
                            invisible="not is_active"
                            confirm="Yakin ingin mengakhiri session user ini?"/>
                    <button name="action_clear_all_user_sessions" string="Clear All Sessions" type="object"
                            class="btn-danger" icon="fa-trash"
                            confirm="HAPUS SEMUA session user ini? User harus login ulang!"/>
                    <field name="is_active" widget="badge"
                           decoration-success="is_active"
                           decoration-muted="not is_active"/>
                </header>
                <sheet>
                    <group>
                        <group string="Info User">
                            <field name="user_id" readonly="1"/>
                            <field name="session_token" readonly="1"/>
                        </group>
                        <group string="Info Device">
                            <field name="ip_address" readonly="1"/>
                            <field name="device_fingerprint" readonly="1"/>
                        </group>
                    </group>
                    <group>
                        <group string="Waktu">
                            <field name="login_time" readonly="1"/>
                            <field name="last_activity" readonly="1"/>
                            <field name="logout_time" readonly="1"/>
                        </group>
                        <group string="Status">
                            <field name="logout_reason" readonly="1"/>
                        </group>
                    </group>
                    <separator string="User Agent"/>
                    <field name="user_agent" readonly="1" widget="text"/>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Session Search View -->
    <record id="view_cert_user_session_search" model="ir.ui.view">
        <field name="name">cert.user.session.search</field>
        <field name="model">cert.user.session</field>
        <field name="arch" type="xml">
            <search string="Search Sessions">
                <field name="user_id"/>
                <field name="ip_address"/>
                <separator/>
                <filter name="active_sessions" string="Session Aktif" domain="[('is_active', '=', True)]"/>
                <filter name="inactive_sessions" string="Session Non-Aktif" domain="[('is_active', '=', False)]"/>
                <separator/>
                <filter name="kicked_by_new_device" string="Kicked (Device Lain)" domain="[('logout_reason', '=', 'new_device')]"/>
                <filter name="admin_logout" string="Admin Logout" domain="[('logout_reason', '=', 'admin')]"/>
                <separator/>
                <filter name="group_by_user" string="User" context="{'group_by': 'user_id'}"/>
                <filter name="group_by_active" string="Status" context="{'group_by': 'is_active'}"/>
                <filter name="group_by_date" string="Login Date" context="{'group_by': 'login_time:day'}"/>
            </search>
        </field>
    </record>

    <!-- Session Action -->
    <record id="action_cert_user_session" model="ir.actions.act_window">
        <field name="name">Session Tracking</field>
        <field name="res_model">cert.user.session</field>
        <field name="view_mode">list,form</field>
        <field name="context">{'search_default_active_sessions': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Belum ada data session.
            </p>
            <p>
                Session akan tercatat ketika user login ke portal sertifikasi.
            </p>
        </field>
    </record>

    <!-- Menu Session under Bank Soal -->
    <menuitem id="menu_iso_session_tracking"
              name="Session Tracking"
              parent="menu_iso_bank_soal"
              action="action_cert_user_session"
              sequence="10"/>

</odoo>
